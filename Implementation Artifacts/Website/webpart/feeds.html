<script type="text/javascript" src="./lib/util.js"></script>
<script type="text/javascript" language="javascript">
	var shortenUrls = {};

	try {
		$.jGFeed(currentFeedUrl, parseFeed, 10);
	} catch(err) {
		alert(err);
	}

	function parseFeed(feeds) {
		if(!feeds) {
			return false;
		}

		var rssHtml = '<ul class="rss-news">';

		for(var i=0; i<feeds.entries.length; i++) {
			var entry = feeds.entries[i];
			rssHtml += '<li>'
			+'<a href="./article.html?src='+ encodeURIComponent(currentFeedUrl) + '&article=' + encodeURIComponent(entry.link) +'" class="rss-title" target="_self">' + entry.title +'</a></br/>'
			+'<span class="rss-publishedDate">' + friendlyDate(new Date(entry.publishedDate)) + '</span>'
			+'<span class="rss-author">' + (entry.author != null && entry.author != '' ? ' by ' + entry.author : '') + '</span>'
			+'<div class="rss-content">'
			+ entry.content
			+'</div>'
			+'<div style="clear:both;">'
			//+'<a id="a_read_more_' + entry.link.hashCode() + '" href="javascript:loadArticle(\''+ currentFeedUrl +'\', \'' + entry.link +'\');" class="rss-read-more">Read more ...</a></div>'
			+'<a href="./article.html?src='+ encodeURIComponent(currentFeedUrl) + '&article=' + encodeURIComponent(entry.link) +'" class="rss-read-more" target="_self">comments ...</a></div>'
			+'</li>';
		}

		rssHtml +="</ul>"
		$('.news-div').each( function () {
			$(this).html(rssHtml);
		});
		
		$('.rss-content iframe').each(function(){
			$(this).remove();	
		});
		
		$('.news-div a').each( function () {
			if(this.target == '')
				this.target = '_blank';
		});
	}

	function loadArticle(feedUrl, articleLink) {
		if(shortenUrls[feedUrl.hashCode()] == undefined || shortenUrls[feedUrl.hashCode()] == '') {
			$.bitlyShortCode(feedUrl, function(src) {
				if(src !='') {
					shortenUrls[feedUrl.hashCode()] = src;
					$.bitlyShortCode(articleLink, function(article) {
						if(article != '') {
							shortenUrls[articleLink.hashCode()] = article;

							var $read_more = $('#a_read_more_' + articleLink.hashCode());
							$read_more.attr('href', './post.html?src=' +src  +'&=article=' + article);
							$read_more.click();
						} else {
							var $read_more = $('#a_read_more_' + articleLink.hashCode());
							$read_more.attr('href', './post.html?src=' + feedUrl +'&=article=' + articleLink);
							$read_more.click();
						}
					});
				} else {

					var $read_more = $('#a_read_more_' + articleLink.hashCode());
					$read_more.attr('href', './post.html?src=' + feedUrl +'&=article=' + articleLink);
					$read_more.click();
				}
			});
		} else if(shortenUrls[articleLink.hashCode()] == undefined || shortenUrls[articleLink.hashCode()] == '') {
			$.bitlyShortCode(articleLink, function(article) {
				if (article != '') {
					shortenUrls[articleLink.hashCode()] = article;
					var $read_more = $('#a_read_more_' + articleLink.hashCode());
					$read_more.attr('href', './post.html?src=' + shortenUrls[feedUrl.hashCode()] +'&=article=' + article);
					$read_more.click();

				} else {
					var $read_more = $('#a_read_more_' + articleLink.hashCode());
					$read_more.attr('href', './post.html?src=' + feedUrl +'&=article=' + articleLink);
					$read_more.click();
				}
			});
		} else {
			var $read_more = $('#a_read_more_' + articleLink.hashCode());
			$read_more.attr('href', './post.html?src=' + shortenUrls[feedUrl.hashCode()] +'&=article=' + shortenUrls[articleLink.hashCode()]);
			$read_more.click();
		}
	}
</script>
<div class="news-div">
	<span>Loading </span>
	<span class="loading">...</span>
</div>

